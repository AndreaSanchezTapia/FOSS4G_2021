<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>español.knit</title>
    <meta charset="utf-8" />
    <meta name="author" content="Andrea Sánchez-Tapia" />
    <meta name="date" content="2021-10-01" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="font.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

class: middle





<div>
<style type="text/css">.xaringan-extra-logo {
width: 300px;
height: 128px;
z-index: 0;
background-image: url(figs/logo.png);
background-size: contain;
background-repeat: no-repeat;
position: absolute;
bottom:1em;left:88%;
}
</style>
<script>(function () {
  let tries = 0
  function addLogo () {
    if (typeof slideshow === 'undefined') {
      tries += 1
      if (tries < 10) {
        setTimeout(addLogo, 100)
      }
    } else {
      document.querySelectorAll('.remark-slide-content:not(.title-slide):not(.inverse):not(.hide_logo)')
        .forEach(function (slide) {
          const logo = document.createElement('div')
          logo.classList = 'xaringan-extra-logo'
          logo.href = null
          slide.appendChild(logo)
        })
    }
  }
  document.addEventListener('DOMContentLoaded', addLogo)
})()</script>
</div>

&lt;style type="text/css"&gt;
.remark-slide-number {
  display: none;
}
&lt;/style&gt;

&lt;br&gt;
&lt;br&gt;
&lt;center&gt;

# Creando flujos de trabajo abiertos y reproducibles para el modelamiento de nichos ecológicos

### Andrea Sánchez-Tapia, Sara Ribeiro Mortara, Felipe Sodré Barros

### FOSS4G Buenos Aires 2021
&lt;/center&gt;
&lt;br&gt;


__[Slides in English](https://andreasancheztapia.github.io/FOSS4G_2021/english#1)__



---
background-image: url("figs/logo_jbrj.png")
background-position: 98% 2%
background-size: 100px
.left-column[
&lt;img src="figs/andrea.jpg" title="fotos del equipo: Andrea Sánchez-Tapia, Sara Mortara, Felipe Sodré Barros, Guilherme Gall, Diogo Rocha, y Marinez Ferreira de Siqueira (Investigadora principal)" alt="fotos del equipo: Andrea Sánchez-Tapia, Sara Mortara, Felipe Sodré Barros, Guilherme Gall, Diogo Rocha, y Marinez Ferreira de Siqueira (Investigadora principal)" width="90" style="display: block; margin: auto auto auto 0;" /&gt;&lt;img src="figs/SRM.jpg" title="fotos del equipo: Andrea Sánchez-Tapia, Sara Mortara, Felipe Sodré Barros, Guilherme Gall, Diogo Rocha, y Marinez Ferreira de Siqueira (Investigadora principal)" alt="fotos del equipo: Andrea Sánchez-Tapia, Sara Mortara, Felipe Sodré Barros, Guilherme Gall, Diogo Rocha, y Marinez Ferreira de Siqueira (Investigadora principal)" width="90" style="display: block; margin: auto auto auto 0;" /&gt;&lt;img src="figs/Felipe_Barros.jpg" title="fotos del equipo: Andrea Sánchez-Tapia, Sara Mortara, Felipe Sodré Barros, Guilherme Gall, Diogo Rocha, y Marinez Ferreira de Siqueira (Investigadora principal)" alt="fotos del equipo: Andrea Sánchez-Tapia, Sara Mortara, Felipe Sodré Barros, Guilherme Gall, Diogo Rocha, y Marinez Ferreira de Siqueira (Investigadora principal)" width="90" style="display: block; margin: auto auto auto 0;" /&gt;&lt;img src="figs/gui.jpeg" title="fotos del equipo: Andrea Sánchez-Tapia, Sara Mortara, Felipe Sodré Barros, Guilherme Gall, Diogo Rocha, y Marinez Ferreira de Siqueira (Investigadora principal)" alt="fotos del equipo: Andrea Sánchez-Tapia, Sara Mortara, Felipe Sodré Barros, Guilherme Gall, Diogo Rocha, y Marinez Ferreira de Siqueira (Investigadora principal)" width="90" style="display: block; margin: auto auto auto 0;" /&gt;&lt;img src="figs/diogo.jpeg" title="fotos del equipo: Andrea Sánchez-Tapia, Sara Mortara, Felipe Sodré Barros, Guilherme Gall, Diogo Rocha, y Marinez Ferreira de Siqueira (Investigadora principal)" alt="fotos del equipo: Andrea Sánchez-Tapia, Sara Mortara, Felipe Sodré Barros, Guilherme Gall, Diogo Rocha, y Marinez Ferreira de Siqueira (Investigadora principal)" width="90" style="display: block; margin: auto auto auto 0;" /&gt;&lt;img src="figs/mari.jpeg" title="fotos del equipo: Andrea Sánchez-Tapia, Sara Mortara, Felipe Sodré Barros, Guilherme Gall, Diogo Rocha, y Marinez Ferreira de Siqueira (Investigadora principal)" alt="fotos del equipo: Andrea Sánchez-Tapia, Sara Mortara, Felipe Sodré Barros, Guilherme Gall, Diogo Rocha, y Marinez Ferreira de Siqueira (Investigadora principal)" width="90" style="display: block; margin: auto auto auto 0;" /&gt;
]

.right-column[
#### Núcleo de Computación Científica y Geoprocesamiento - Jardín Botánico de Río de Janeiro
#### ¡liibre! Laboratorio Independiente de Informática de la Biodiversidad y Reproducibilidad en Ecología


+ Flujos de trabajo científicos basados en R para descarga y limpieza de datos, verificación taxonómica
+ Informática de la biodiversidad, MNE, ciencia abierta, reproducibilidad
+ Soporte a proyectos de investigación que utilizan datos sobre biodiversidad (e.g., CNCFlora - autoridad UICN para la Flora de Brasil)
]

---

### Modelos de nicho ecológico o de distribución potencial de especies (ENM, SDM)

+ __Aprendizaje estadístico__ aplicado a la preducción de áreas potencialmente adecuadas para la presencia de especies
--

  + Datos de ocurrencia de las especies (bases de dados de colecciones)
--

  + Variables predictoras ambientales (Worldclim, sensoriamiento remoto)
--

  + Diferentes algoritmos (GLM, SVM, Bosques aleatorios, árboles de clasificación, GBM)
--

  + Desempeño de modelos (partición de los datos en conjunto de entrenamiento y test + métricas de desempeño)
--

+ Primeras implementaciones: código oculto, uso interactivo con el ratón (_"point-and-click"_)

---
background-image: url("https://www.r-project.org/Rlogo.png")
background-position: 4% 4%
background-size: 200px

&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;

- Lenguaje de programación en estadística
--

- Software libre, código abierto, _lingua franca_ en Ecología
--

- Varias opciones para ENM/SDM dentro de R
--

  - SIG con __raster__, __sp__, __maps__, __rgdal__, __sf__
--

  - Paquetes reconocidos como __dismo__ (Hijmans et al 2017), __BIOMOD2__ (Thuiller et al 2007)
--

  - Paquetes recientes: **ENMeval** (Muscarella et al 2014), **sdm** (Naimi &amp; Araujo 2016), **spThin** (Aiello-Lammens et al 2015), **zoon** (Golding et al. 2018), **wallace** (Kass et al 2018), **kuenm** (Cobos et al 2019), **occCite** (Lowens 2020)
--

#### Dificultad con escalabilidad, repetición de código, documentación de decisiones... .purple[no reproducilibidad]

---
background-image: url("https://the-turing-way.netlify.app/_static/logo.jpg")
background-position: 4% 4%
background-size: 150px
class: middle

+ [Investigación abierta](https://the-turing-way.netlify.app/reproducible-research/open.html): reproducible, transparente, reutilizable, colaborativa, responsable, accesible a la sociedad
+ [Reproducibilidad](https://the-turing-way.netlify.app/reproducible-research/reproducible-research.html):
datos y código disponibles para volver a rodar los análisis

---
background-image: url("figs/modleR.png")
background-position: 4% 4%
background-size: 150px

&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;

- Un .purple[flujo de trabajo] desarrollado para __integrar y automatizar__ algunos de los pasos comunes en el modelamiento de nichos ecológicos
--

- Cuatro pasos:
--

  + `setup_sdmdata()`: configuración de datos, limpieza, partición, selección de pseudoausencias
--

  + `do_any()` and `do_many()`: ajuste, proyección y evaluación del modelo
--

  + `final_model()`: uniendo particiones
--

  + `ensemble_model()`: consenso entre algoritmos

---
background-image: url("figs/modleR.png")
background-position: 4% 4%
background-size: 150px

.right[
## un flujo de trabajo en cuatro pasos

&lt;img src="figs/WORKFLOW.png" title="Esquema del flujo de trabajo. el primer paso limpia y particiona los datos en conjunto de entrenamiento y test, muestrea pseudoausencias y controla la correlación de las variables explicativas. En el segundo paso cada algoritmo genera un modelo por partición, con variación entre ellas debido a la diferencia en los conjuntos de entrenamiento y test. En el tercer paso final_model() junta esas particiones de diferentes maneras, generando un modelo por algoritmo. El cuarto paso analiza el consenso entre algoritmos, en el paso que denominamos 'ensemble modeling', para obtener un único modelo por especie" alt="Esquema del flujo de trabajo. el primer paso limpia y particiona los datos en conjunto de entrenamiento y test, muestrea pseudoausencias y controla la correlación de las variables explicativas. En el segundo paso cada algoritmo genera un modelo por partición, con variación entre ellas debido a la diferencia en los conjuntos de entrenamiento y test. En el tercer paso final_model() junta esas particiones de diferentes maneras, generando un modelo por algoritmo. El cuarto paso analiza el consenso entre algoritmos, en el paso que denominamos 'ensemble modeling', para obtener un único modelo por especie" width="1000" /&gt;
]

---
## 1. `setup_sdmdata()`: preparación de datos

Preparación y limpieza de datos debe realizarse previamente

- Limpieza de datos: datos duplicados, NA y una ocurrencia por píxel
- Diseño experimental: *bootstrap*, validación cruzada
- Muestreo de pseudo-ausencias
- Control de correlación de variables hasta un valor definido por el usuarie (p. ej., 0,8)

---
## muestreo de pseudo-ausencias

&lt;img src="figs/fig04_buffer.png" width="800" style="display: block; margin: auto;" /&gt;

---
## 2. `do_(m)any()`: ajuste y proyección del modelo

- `do_any()` para un algoritmo y partición (ej. `algo = "maxent"`)
- `do_many()` llama a `do_any()` para ajustar múltiples algoritmos (ej. `bioclim = TRUE`, `maxent = TRUE`)
- Parametrización
- Algoritmos: dismo, maxnet, GLM, SVM, bosques aleatorios, boosted regression trees (BRT)
- Proyección a diferentes conjuntos de datos (en el tiempo o el espacio)
- Devuelve una tabla con estadísticas de desempeño `-&gt;` TSS, AUC, pROC, FNR, Jaccard


---
## 2. `do_(m)any()`: ajuste y proyección del modelo

&lt;img src="figs/modleR/rf_cont_Abarema_langsdorffii_1_1.png" width="300" /&gt;&lt;img src="figs/modleR/rf_cont_Abarema_langsdorffii_1_2.png" width="300" /&gt;&lt;img src="figs/modleR/rf_cont_Abarema_langsdorffii_1_3.png" width="300" /&gt;

_Abarema langsdorffii_, tres particiones, bosques aleatorios

---
## 3. `final_model()`: un modelo por algoritmo por especie

- lo básico: una medida de tendencia central e incertidumbre entre particiones
- ¿qué modelos unir? (el modelo continuo sin procesar, el binario)
- algunas operaciones adicionales: consenso entre modelos binarios
- incertidumbre: rango (max-min) entre particiones

---
## 3. `final_model()`: un modelo por algoritmo por especie


.center[
&lt;img src="figs/fig05_finalmodel.png" width="400" /&gt;
]

---
## 3. `final_model()`: un modelo por algoritmo por especie


&lt;img src="figs/modleR/Abarema_langsdorffii_rf_raw_mean.png" width="300" /&gt;&lt;img src="figs/modleR/Abarema_langsdorffii_rf_bin_consensus.png" width="300" /&gt;&lt;img src="figs/modleR/Abarema_langsdorffii_rf_raw_uncertainty.png" width="300" /&gt;

Media de los modelos brutos
Consenso de los modelos binarios
Incertidumbre (rango)

---
## 4. `ensemble_model()` - consenso entre algoritmos

- Media entre `final_models()`
- Algoritmo de mejor desempeño
- PCA entre algoritmos
- Métricas de incertidumbre
- Los modelos *ensemble* no necesariamente funcionan mejor que los algoritmos individuales (Zhu &amp; Peterson 2017)
+ Evaluar el desempeño de diferentes métodos de consenso (WIP)


---
## estructura de carpetas y portabilidad

.pull-left[
- Un único directorio de trabajo por proyecto
- Diferentes pasos: diferentes subcarpetas
- Una estructura de subcarpetas consistente
- Rutas relativas en lugar de absolutas y no `setwd()`
]

.pull-right[
&lt;img src="figs/fig03_folder.png" width="772" /&gt;
]

---
## modularidad

- Cada paso guarda su salida
- El siguiente paso lee la salida anterior
- Usando espacio en disco en lugar de RAM
- Se puede entrar y salir del flujo de trabajo en cualquier paso
- Paralelización y uso en marcos computacionales de alto procesamiento / alto rendimiento (HPC / HTC)

&lt;img src="figs/sdmdata_table.png" width="828" /&gt;

---
## reproducibilidad

&lt;img src="figs/feng.png" width="600" /&gt;

---
## registro detallado de metadatos

 - opciones de parametrización
 - información de sesión
 - paquetes utilizados y su versión


&lt;img src="figs/metadata.png" width="600" /&gt;

---
## interoperabilidad

No creamos nuevas clases o métodos: comunicación con otros paquetes de R

&lt;img src="figs/xkcd_standards.png" title="cómic de xkcd: título: ¿cómo proliferan los estándares? subtítulo: (ver: cargadores de corriente alternativa A/C, codificación de caracteres, mensajería instantánea, etc.) Primer cuadro: Situación: Hay 14 estándares compitiendo. Segundo cuadro: dos figuras humanas. Persona 1: '¿14? ¡Ridículo! Necesitamos desarrollar un estándar universal que cubra todos los casos de uso' Persona 2: '¡sí!'. Tercer cuadro: Pronto: Situación: Hay 15 estándares compitiendo" alt="cómic de xkcd: título: ¿cómo proliferan los estándares? subtítulo: (ver: cargadores de corriente alternativa A/C, codificación de caracteres, mensajería instantánea, etc.) Primer cuadro: Situación: Hay 14 estándares compitiendo. Segundo cuadro: dos figuras humanas. Persona 1: '¿14? ¡Ridículo! Necesitamos desarrollar un estándar universal que cubra todos los casos de uso' Persona 2: '¡sí!'. Tercer cuadro: Pronto: Situación: Hay 15 estándares compitiendo" width="719" /&gt;

---

## final remarks

- La reproducibilidad debería impulsar cualquier flujo de trabalho de MNE
- Los metadatos son realmente útiles y necesarios
- Cualquier flujo de trabajo MNE debe adaptarse fácilmente a HPC
- La flexibilidad para empezar y salir en cualquier paso es fundamental para garantir una evaluación sólida de los ENM
 - No es un problema tener un paquete más si se integra con otros paquetes

---
## final remarks

+ Invest in:
  + learning script-based applications (programming)
  + version control (git)
+ Use tools for environment reproducibility (__Renv__ package, Docker containers)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"seal": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
